# 背景知识

### 目前发售的VR/AR产品及使用的定位技术

##### VR/AR产品中的定位技术主要完成以下目标：

- 6DOF的追踪（在三维空间中的位置和姿态）
- 毫米级或者更高精度
- 满足实时性要求
- VR/AR往往在相对较小的空间范围内使用

##### VR/AR产品中使用的定位技术：

- 基于IMU的定位
  
  IMU主要包含加速度计和陀螺仪两种传感器，基本原理是积分获得位移和姿态变化，因此存在累积误差而不准确。有些IMU包含磁力计，可以获得地球磁场方向，能够替代陀螺仪获取姿态变化，但是地球磁场容易受到附近金属物体的影响，故准确性不高。
  
  目前的IMU多为MEMS工艺的IMU，价格低廉，采样频率可以达到100Hz～1000Hz。
  
  如Google多年前发布的Cardboard是使用手机作为计算和显示设备，其定位是依靠手机内的IMU实现的。

- 光学定位—Outside-in
  
  Outside-in技术的光学定位，均需要设置头盔之外的额外设备，作为提供绝对世界坐标的“灯塔”。如HTC vive的Lighthouse技术，在头盔和手柄上分布有光敏传感器，外部设置两个或多个激光扫描模块辅助定位；Oculus Rift则是在头盔和手柄上分布有红外发射器，外部设置红外相机辅助定位；PlayStation VR与Oculus Rift类似，只是将红外线改为可见光。
  
  使用Outside-in技术的VR/AR设备，相对于只有IMU的设备更为精确，但通常具有如下缺点：(1)首次使用时需要对外部的辅助设备进行设置，设置过程往往颇为复杂，且会对定位准确性有很大影响；(2)使用范围被外部辅助设备所限制；(3)头盔和外部辅助设备之间不能有遮挡。

- 光学定位—Inside-out
  
  Inside-out技术的光学定位，无需Outside-in技术中的额外设备。其主要原理是通过头盔上安装的单目或双目摄像头采集图像信息，使用特征点识别和匹配，或者直接进行匹配，以推导出摄像头的位姿变化。目前Insinde-out技术是VR/AR产品的发展趋势，Microsoft Hololens、HTC vive cosmos、Oculus Rift S均采用的是Inside-out技术，主要是将基于Inside-out的光学定位与基于IMU的定位相融合，提高定位精度和鲁棒性，降低算法的复杂度。这种融合的定位方式与视觉SLAM技术的前端基本相同，也称为视觉惯性里程计VIO。
  
  如Microsoft Hololens中，使用一个IMU和四个环境感知摄像头负责定位，深度摄像头负责三维重建。Google project Tango中的运动追踪采用的同样是基于Inside-out和IMU的视觉惯性里程计技术。

- 其他
  
  其它的一些VR/AR使用的定位技术，目前和不够主流，需要经过时间检验其价值。如
  
  - 基于UWB技术的定位，无需担心遮挡，但精度只能达到10cm级。
  
  - 基于WiFi的定位。

### 视觉里程计VO

视觉里程计（vision odometry, VO）通过分析单个或多个相机所获得的图像流信息估计宿主的位姿，成本较低，能够在室内、水下、空中等GPS可能效的环境中工作。视觉里程计中由相机采集图像信息，采用特征点提取和匹配估计运动，或者采用直接法估计运动，然后使用滤波或者非线性优化的方法减小漂移误差。

VO中使用的相机可以分为单目、双目（或称立体）和RGB-D相机。单目相机无法直接获得目标的绝对深度，需要依靠前后两帧之间的三角测量获得空间点位置，且运动不能只有旋转，其应用场景受到了限制。双目相机使用一帧就可以三角测量获得目标深度，但是量程受到基线长度的限制。RGB-D相机可以直接获得深度信息，但是受限于较高的成本而无法普遍使用。

利用图像信息的方法有特征法和直接法。特征法是提取图像的显著特征建立图像之间的关联，计算成本较低，但是对于缺乏特征的场景效果较差。直接法利用图像像素变化的梯度建立图像之间的关联，由于充分利用了图像信息，因此计算量相对较大。直接法还可以分为稀疏、半稠密、稠密三种，指的是采集像素点的数目。在两种方法下的运动估计主要是根据空间和图像的几何关系进行计算，根据不同的应用场景会有所差别。

减少漂移的方法有采用滤波的方法和非线性优化的方法。滤波方法是较为传统的方法，如扩展卡尔曼滤波、无迹滤波、粒子滤波等，滤波法通常假设了运动过程中的马尔可夫性，即当前时刻只与上一时刻相关，而与之前时刻的状态和观测都无关，依然容易造成误差累积。非线性优化的方法考虑到当前时刻与之前所有的状态都相关，因而能够获得比滤波方法更好的效果，是目前主流的方法。优化方法的计算量相对较大，因而往往选取图像信息流中的特定关键帧作为节点，建立当前节点与之前多个节点之间的变换关系，是不是将所有的帧都作为优化的依据，以降低计算代价，但同时还需要不断维护节点。

在SLAM中，回环检测能够有效地降低漂移误差。回环检测需要使用之前采集的地图信息，地图信息的收集是与SLAM的三维重建相一致，基本不会产生额外的计算资源消耗。在仅使用视觉定位的视觉里程计中，采集地图信息需要额外的计算资源的支持，因此多无法进行回环检测。

随着近年来深度学习的流行，一些基于深度学习的视觉里程计方法，试图揭示图像光流和相机运动的关系，无需建立运动的几何模型即可估计运动。目前此类方法一方面鲁棒性不足，另一方面需要使用较多的计算资源，实用价值不高。

### 视觉惯性里程计VIO

视觉惯性里程计是同时利用视觉里程计和IMU来完成定位或位姿估计的技术。与视觉里程计类似，根据所使用的减小漂移误差的方法，可以分为基于滤波的VIO和基于优化的VIO；根据相机数据与IMU数据的结合方式，可以分为松耦合和紧耦合两种。其中松耦合指相机和IMU分别利用自己采集的信息完成自身的运动估计，然后对设备的位姿估计进行融合；紧耦合指将相机和IMU的状态合并在一起，共同构建方程进行运动估计和设备的位姿估计。

除了将视觉与IMU信息融合的位姿估计方法，现在越来越多的SLAM技术倾向于使用多种传感器来提高定位系统的可靠性和稳定性。

##### 参考文献：

*慈文彦, 黄影平, 胡兴. 视觉里程计算法研究综述[J]. 计算机应用研究, 2019(9).*

*孙永全,田红丽. 视觉惯性SLAM综述[J]. 计算机应用研究,,:1-6.* 